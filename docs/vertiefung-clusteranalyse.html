<!DOCTYPE html>
<html  lang="de-De">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Praxis der Datenanalyse</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Eine Einführung in moderne Statistik für Praktiker">
  <meta name="generator" content="bookdown 0.2.3 and GitBook 2.6.7">

  <meta property="og:title" content="Praxis der Datenanalyse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="cover.jpg" />
  <meta property="og:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="github-repo" content="sebastiansauer/Praxis_der_Datenanalyse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Praxis der Datenanalyse" />
  
  <meta name="twitter:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="twitter:image" content="cover.jpg" />

<meta name="author" content="Sebastian Sauer, Matthias Gehrke, Karsten Lübke, Oliver Gansser">


<meta name="date" content="2017-04-26">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="iv-ungeleitetes-modellieren.html">
<link rel="next" href="vi-anhang.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Praxis der Datenanalyse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vertiefung-clusteranalyse" class="section level1">
<h1><span class="header-section-number">Kapitel 14</span> Vertiefung: Clusteranalyse</h1>
<div id="einfuhrung" class="section level2">
<h2><span class="header-section-number">14.1</span> Einführung</h2>
<p>Das Ziel einer Clusteranalyse ist es, Gruppen von Beobachtungen (d. h. <em>Cluster</em>) zu finden, die innerhalb der Cluster möglichst homogen, zwischen den Clustern möglichst heterogen sind. Um die Ähnlichkeit von Beobachtungen zu bestimmen, können verschiedene Distanzmaße herangezogen werden. Für metrische Merkmale wird z. B. häufig die euklidische Metrik verwendet, d. h., Ähnlichkeit und Distanz werden auf Basis des euklidischen Abstands bestimmt. Aber auch andere Abstände wie “Manhatten” oder “Gower” sind möglich. Letztere haben den Vorteil, dass sie nicht nur für metrische Daten sondern auch für gemischte Variablentypen verwendet werden können. Wir werden uns hier auf den euklischen Abstand konzentrieren.</p>
</div>
<div id="intuitive-darstellung-der-clusteranalayse" class="section level2">
<h2><span class="header-section-number">14.2</span> Intuitive Darstellung der Clusteranalayse</h2>
<p>Betrachten Sie das folgende Streudiagramm (die Daten sind frei erfunden; “simuliert”, sagt der Statistiker). Es stellt den Zusammenhang von Lernzeit (wieviel ein Student für eine Statistikklausur lernt) und dem Klausurerfolg (wie viele Punkte ein Student in der Klausur erzielt) dar. Sehen Sie Muster? Lassen sich Gruppen von Studierenden mit bloßem Auge abgrenzen (Abb. <a href="vertiefung-clusteranalyse.html#fig:cluster1">14.1</a>)?</p>
<div class="figure" style="text-align: center"><span id="fig:cluster1"></span>
<img src="082_Clusteranalyse_files/figure-html/cluster1-1.png" alt="Ein Streudiagramm - sehen Sie Gruppen (Cluster) ?" width="70%" />
<p class="caption">
Abbildung 14.1: Ein Streudiagramm - sehen Sie Gruppen (Cluster) ?
</p>
</div>
<p>Färben wir das Diagramm mal ein (Abb. <a href="vertiefung-clusteranalyse.html#fig:cluster2">14.2</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:cluster2"></span>
<img src="082_Clusteranalyse_files/figure-html/cluster2-1.png" alt="Ein Streudiagramm - mit drei Clustern" width="70%" />
<p class="caption">
Abbildung 14.2: Ein Streudiagramm - mit drei Clustern
</p>
</div>
<p>Nach dieser “Färbung”, d.h. nach dieser Aufteilung in drei Gruppen, scheint es folgende “Cluster”, “Gruppen” oder “Typen” von Studierenden zu geben:</p>
<ul>
<li><p>“Blaue Gruppe”: Fälle dieser Gruppe lernen wenig und haben wenig Erfolg in der Klausr. Tja.</p></li>
<li><p>“Rote Gruppe”: Fälle dieser Gruppe lernen viel; der Erfolg ist recht durchwachsen.</p></li>
<li><p>“Grüne Gruppe”: Fälle dieser Gruppe lernen mittel viel und erreichen einen vergleichsweise großen Erfolg in der Klausur.</p></li>
</ul>
<p>Drei Gruppen scheinen ganz gut zu passen. Wir hätten theoretisch auch mehr oder weniger Gruppen unterteilen können. Die Clusteranalyse gibt keine definitive Anzahl an Gruppen vor; vielmehr gilt es, aus theoretischen und statistischen Überlegungen heraus die richtige Anzahl auszuwählen (dazu gleich noch mehr).</p>
<p>Unterteilen wir zur Illustration den Datensatz einmal in bis zu 9 Cluster (Abb. <a href="vertiefung-clusteranalyse.html#fig:cluster3">14.3</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:cluster3"></span>
<img src="082_Clusteranalyse_files/figure-html/cluster3-1.png" alt="Unterschiedliche Anzahlen von Clustern im Vergleich" width="70%" />
<p class="caption">
Abbildung 14.3: Unterschiedliche Anzahlen von Clustern im Vergleich
</p>
</div>
<p>Das “X” soll den “Mittelpunkt” des Clusters zeigen. Der Mittelpunkt ist so gewählt, dass die Distanz von jedem Punkt zum Mittelpunkt möglichst kurz ist. Dieser Abstand wird auch “Varianz innerhalb des Clusters” oder kurz “Varianz within” bezeichnet. Natürlich wird diese Varianz within immer kleiner, je größer die Anzahl der Cluster wird.</p>
<div class="figure" style="text-align: center"><span id="fig:cluster4"></span>
<img src="082_Clusteranalyse_files/figure-html/cluster4-1.png" alt="Die Summe der Varianz within in Abhängigkeit von der Anzahl von Clustern. Ein Screeplot." width="70%" />
<p class="caption">
Abbildung 14.4: Die Summe der Varianz within in Abhängigkeit von der Anzahl von Clustern. Ein Screeplot.
</p>
</div>
<p>Die vertikale gestrichtelte Linie zeigt an, wo die Einsparung an Varianz auf einmal “sprunghaft” weniger wird - just an jedem Knick bei x=3; dieser “Knick” wird auch “Ellbogen” genannt (da sage einer, Statistiker haben keine Phantasie). Man kann jetzt sagen, dass 3 Cluster eine gute Lösung seien, weil mehr Cluster die Varianz innerhalb der Cluster nur noch wenig verringern. Diese Art von Diagramm wird als “Screeplot” bezeihchnet. Fertig!</p>
</div>
<div id="euklidische-distanz" class="section level2">
<h2><span class="header-section-number">14.3</span> Euklidische Distanz</h2>
<p>Aber wie weit liegen zwei Punkte entfernt? Betrachten wir ein Beispiel. Anna und Berta sind zwei Studentinnen, die eine Statistikklausur <del>geschrieben haben</del>schreiben mussten (bedauernswert). Die beiden unterscheiden sich sowohl in Lernzeit als auch in Klausurerfolg. Aber wie sehr unterscheiden sie sich? Wie groß ist der “Abstand” zwischen Anna und Berta (vgl. Abb. <a href="vertiefung-clusteranalyse.html#fig:distanz">14.5</a>)?</p>
<div class="figure" style="text-align: center"><span id="fig:distanz"></span>
<img src="images/cluster/distanz_crop.pdf" alt="Distanz zwischen zwei Punkten in der Ebene" width="70%" />
<p class="caption">
Abbildung 14.5: Distanz zwischen zwei Punkten in der Ebene
</p>
</div>
<p>Eine Möglichkeit, die Distanz zwischen zwei Punkten in der Ebene (2D) zu bestimmen, ist der <em>Satz des Pythagoras</em> (leise Trompetenfanfare). Generationen von Schülern haben diese Gleichung geliebt:</p>
<p><span class="math display">\[c^2 = a^2 + b^2\]</span></p>
<p>In unserem Beispiel heißt das <span class="math inline">\(c^2 = 3^2+4^2 = 25\)</span>. Folglich ist <span class="math inline">\(\sqrt{c^2}=\sqrt{25}=5\)</span>. Der Abstand oder der Unterschied zwischen Anna und Berta beträgt also 5 - diese Art von “Abstand” nennt man den <em>euklidischen Abstand</em>.</p>
<p>Aber kann man den euklidischen Abstand auch in 3D (Raum) verwenden? Oder gar in Räumen mehr mehr Dimensionen??? Betrachten wir den Versuch, zwei Dreiecke in 3D zu zeichnen. Stellen wir uns vor, zusätzlich zu Lernzeit und Klausurerfolg hätten wir als 3. Merkmal der Studentinnen noch “Statistikliebe” erfasst (Bertas Statistikliebe ist um 2 Punkte höher als Annas).</p>
<div class="figure" style="text-align: center"><span id="fig:pythagoras2"></span>
<img src="images/cluster/pythagoras2_crop.pdf" alt="Pythagoras in 3D" width="70%" />
<p class="caption">
Abbildung 14.6: Pythagoras in 3D
</p>
</div>
<p>Sie können sich Punkt <span class="math inline">\(A\)</span> als Ecke eines Zimmers vorstellen; Punkt <span class="math inline">\(B\)</span> schwebt dann in der Luft, in einiger Entfernung zu <span class="math inline">\(A\)</span>.</p>
<p>Wieder suchen wir den Abstand zwischen den Punkten <span class="math inline">\(A\)</span> und <span class="math inline">\(B\)</span>. Wenn wir die Länge <span class="math inline">\(e\)</span> wüssten, dann hätten wir die Lösung; <span class="math inline">\(e\)</span> ist der Abstand zwischen <span class="math inline">\(A\)</span> und <span class="math inline">\(B\)</span>. Im orange farbenen Dreieck gilt wiederum der Satz von Pythagoras: <span class="math inline">\(c^2+d^2=e^2\)</span>. Wenn wir also <span class="math inline">\(c\)</span> und <span class="math inline">\(d\)</span> wüssten, so könnten wir <span class="math inline">\(e\)</span> berechnen… <span class="math inline">\(c\)</span> haben wir ja gerade berechnet (5) und <span class="math inline">\(d\)</span> ist einfach der Unterschied in Statistikliebe zwischen Anna und Berta (2)! Also</p>
<p><span class="math display">\[e^2 = c^2 + d^2\]</span> <span class="math display">\[e^2 = 5^2 + 2^2\]</span> <span class="math display">\[e^2 = 25 + 4\]</span></p>
<p><span class="math display">\[e = \sqrt{29} \approx 5.4\]</span></p>
<p>Ah! Der Unterschied zwischen den beiden Studentinnen beträgt also ~5.4!</p>
<p>Intuitiv gesprochen, “schalten wir mehrere Pythagoras-Sätze hintereinander”.</p>
<blockquote>
<p>Der euklidische Abstand berechnet sich mit Pythagoras’ Satz!</p>
</blockquote>
<div class="figure" style="text-align: center"><span id="fig:pythagoras"></span>
<img src="images/cluster/pythagoras_crop.pdf" alt="Pythagoras in Reihe geschaltet" width="70%" />
<p class="caption">
Abbildung 14.7: Pythagoras in Reihe geschaltet
</p>
</div>
<p>Das geht nicht nur für “zwei Dreiecke hintereinander”, sondern der Algebra ist es wurscht, wie viele Dreiecke das sind.</p>
<blockquote>
<p>Um den Abstand zweier Objekte mit <em>k</em> Merkmalen zu bestimmen, kann der euklische Abstand berechnet werden mit. Bei k=3 Merkmalen lautet die Formel dann <span class="math inline">\(e^2 = a^2 + b^2 + d^2\)</span>. Bei mehr als 3 Merkmalen erweitert sich die Formel entsprechend.</p>
</blockquote>
<p>Dieser Gedanken ist mächtig! Wir können von allen möglichen Objekten den Unterschied bzw. die (euklidische) Distanz ausrechnen! Betrachten wir drei Professoren, die einschätzen sollten, wir sehr sie bestimmte Filme mögen (1: gar nicht; 10: sehr). Die Filme waren: “Die Sendung mit der Maus”, “Bugs Bunny”, “Rambo Teil 1”, “Vom Winde verweht” und “MacGyver”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">profs &lt;-<span class="st"> </span><span class="kw">data_frame</span>(
  <span class="dt">film1 =</span> <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">8</span>),
  <span class="dt">film2 =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">7</span>),
  <span class="dt">film3 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">3</span>),
  <span class="dt">film4 =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>),
  <span class="dt">film5 =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">6</span>)
)</code></pre></div>
<p>Betrachten Sie die Film-Vorlieben der drei Professoren. Gibt es ähnliche Professoren hinsichtlich der Vorlieben? Welche Professoren haben eingen größeren “Abstand” in ihren Vorlieben?</p>
<p>Wir könnten einen “fünffachen Pythagoras” zu Rate ziehen. Praktischerweise gibt es aber eine R-Funktion, die uns die Rechnerei abnimmt:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dist</span>(profs)
<span class="co">#&gt;       1     2</span>
<span class="co">#&gt; 2 13.23      </span>
<span class="co">#&gt; 3  2.65 10.77</span></code></pre></div>
<p>Offenbar ist der (euklidische) Abstand zwischen Prof. 1 und 2 groß (13.2); zwischen Prof 2 und 3 auch recht groß (10.8). Aber der Abstand zwischen Prof. 1 und 3 ist relativ klein! Endlich hätten wir diese Frage auch geklärt. Sprechen Sie Ihre Professoren auf deren Filmvorlieben an…</p>
</div>
<div id="daten" class="section level2">
<h2><span class="header-section-number">14.4</span> Daten</h2>
<p>Schauen wir uns eine Clusteranalyse praktisch an. Wir werden einen <em>simulierten</em> Datensatz aus <em>Chapman &amp; Feit (2015): R for Marketing Research and Analytics. Springer</em> analysieren (<a href="http://r-marketing.r-forge.r-project.org" class="uri">http://r-marketing.r-forge.r-project.org</a>). Näheres dazu siehe Kapitel 5 dort.</p>
<p>Sie können ihn von <a href="https://goo.gl/eUm8PI" class="uri">https://goo.gl/eUm8PI</a> als <code>csv</code>-Datei herunterladen; oder, wenn sich die Datei im Unterordner <code>data/</code> (relativ zu ihrem Arbeitsverzeichnis) befindet:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">segment &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&quot;data/segment.csv&quot;</span>)</code></pre></div>
<p>Wir verwenden die Variante <code>read.csv2</code>, da es sich um eine “deutsche” CSV-Datei handelt.</p>
<p>Ein Überblick über die Daten verschafft uns die Funktion <code>glimpse</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(segment)
<span class="co">#&gt; Observations: 300</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; $ Alter          &lt;dbl&gt; 50.2, 40.7, 43.0, 40.3, 41.1, 40.2, 39.5, 35.7,...</span>
<span class="co">#&gt; $ Geschlecht     &lt;fctr&gt; Mann, Mann, Frau, Mann, Frau, Mann, Frau, Mann...</span>
<span class="co">#&gt; $ Einkommen      &lt;dbl&gt; 51356, 64411, 71615, 42728, 71641, 60325, 54746...</span>
<span class="co">#&gt; $ Kinder         &lt;int&gt; 0, 3, 2, 1, 4, 2, 5, 1, 1, 0, 3, 4, 0, 2, 6, 0,...</span>
<span class="co">#&gt; $ Eigenheim      &lt;fctr&gt; Nein, Nein, Ja, Nein, Nein, Ja, Nein, Nein, Ne...</span>
<span class="co">#&gt; $ Mitgliedschaft &lt;fctr&gt; Nein, Nein, Nein, Nein, Nein, Nein, Ja, Ja, Ne...</span>
<span class="co">#&gt; $ Segment        &lt;fctr&gt; Gemischte Vorstadt, Gemischte Vorstadt, Gemisc...</span></code></pre></div>
</div>
<div id="distanzmae-mit-r-berechnen" class="section level2">
<h2><span class="header-section-number">14.5</span> Distanzmaße mit R berechnen</h2>
<p>Auf Basis der drei metrischen Merkmale (d. h. <code>Alter</code>, <code>Einkommen</code> und <code>Kinder</code>) ergeben sich für die ersten sechs Beobachtungen folgende Abstände:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dist</span>(<span class="kw">head</span>(segment))
<span class="co">#&gt;         1       2       3       4       5</span>
<span class="co">#&gt; 2 19941.8                                </span>
<span class="co">#&gt; 3 30946.1 11004.3                        </span>
<span class="co">#&gt; 4 13179.5 33121.3 44125.6                </span>
<span class="co">#&gt; 5 30985.9 11044.0    39.9 44165.3        </span>
<span class="co">#&gt; 6 13700.4  6241.5 17245.8 26879.9 17285.5</span></code></pre></div>
<p>Sie können erkennen, dass die Beobachtungen <code>5</code> und <code>3</code> den kleinsten Abstand haben, während <code>5</code> und <code>4</code> den größten haben. Allerdings zeigen die Rohdaten auch, dass die euklidischen Abstände von der Skalierung der Variablen abhängen (<code>Einkommen</code> streut stärker als <code>Kinder</code>). Daher kann es evt. sinnvoll sein, die Variablen vor der Analyse zu standardisieren (z. B. über <code>scale()</code>).</p>
<p>Mit der Funktion <code>daisy()</code> aus dem Paket <code>cluster</code> kann man sich den Abstand zwischen den Objekten ausgeben lassen. Die Funktion errechnet auch Abstandsmaße, wenn die Objekte unterschiedliche Skalenniveaus aufweisen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">daisy</span>(<span class="kw">head</span>(segment))
<span class="co">#&gt; Dissimilarities :</span>
<span class="co">#&gt;       1     2     3     4     5</span>
<span class="co">#&gt; 2 0.307                        </span>
<span class="co">#&gt; 3 0.560 0.390                  </span>
<span class="co">#&gt; 4 0.219 0.184 0.502            </span>
<span class="co">#&gt; 5 0.516 0.220 0.242 0.404      </span>
<span class="co">#&gt; 6 0.401 0.206 0.239 0.268 0.426</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Metric :  mixed ;  Types = I, N, I, I, N, N, N </span>
<span class="co">#&gt; Number of objects : 6</span></code></pre></div>
</div>
<div id="k-means-clusteranalyse" class="section level2">
<h2><span class="header-section-number">14.6</span> k-Means Clusteranalyse</h2>
<p>Beim k-Means Clusterverfahren handelt es sich um eine bestimmte Form von Clusteranalysen; zahlreiche Alternativen existieren, aber die k-Means Clusteranalyse ist recht verbreitet. Im Gegensatz zur z.B. der hierarchischen Clusteranalyse um ein partitionierendes Verfahren. Die Daten werde in k Cluster aufgeteilt – dabei muss die Anzahl der Cluster im vorhinein feststehen. Ziel ist es, dass die Quadratsumme der Abweichungen der Beobachtungen im Cluster zum Clusterzentrum minimiert wird.</p>
<p>Der Ablauf des Verfahrens ist wie folgt:</p>
<ol style="list-style-type: decimal">
<li>Zufällige Beobachtungen als Clusterzentrum</li>
<li>Zuordnung der Beobachtungen zum nächsten Clusterzentrum (Ähnlichkeit, z. B. über die euklidische Distanz)</li>
<li>Neuberechnung der Clusterzentren als Mittelwert der dem Cluster zugeordneten Beobachtungen</li>
</ol>
<p>Dabei werden die Schritte 2. und 3. solange wiederholt, bis sich keine Änderung der Zuordnung mehr ergibt – oder eine maximale Anzahl an Iterationen erreicht wurde.</p>
<p><em>Hinweis:</em> Die (robuste) Funktion <code>pam()</code> aus dem Paket <code>cluster</code> kann auch mit allgemeinen Distanzen umgehen. Außerdem für gemischte Variablentypen gut geeignet: Das Paket <a href="https://cran.r-project.org/web/packages/clustMixType/index.html"><code>clustMixType</code></a>.</p>
<p>Zur Vorbereitung überführen wir die nominalen Merkmale in logische, d. h. binäre Merkmale, und löschen die Segmente sowie das Ergebnis der hierarchischen Clusteranalyse:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">segment.num &lt;-<span class="st"> </span>segment %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Frau =</span> Geschlecht ==<span class="st"> &quot;Frau&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Eigenheim =</span> Eigenheim ==<span class="st">&quot;Ja&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Mitgliedschaft =</span> Mitgliedschaft ==<span class="st"> &quot;Ja&quot;</span>) %&gt;%
<span class="st">  </span>dplyr::<span class="kw">select</span>(-Geschlecht, -Segment)</code></pre></div>
<p>Über die Funktion <code>mutate()</code> werden Variablen im Datensatz erzeugt oder verändert. Über <code>select()</code> werden einzene Variablen ausgewählt. Die “Pfeife” <code>%&gt;%</code> übergeben das Ergebnis der vorherigen Funktion an die folgende.</p>
<p>Aufgrund von (1.) hängt das Ergebnis einer k-Means Clusteranalyse vom Zufall ab. Aus Gründen der Reproduzierbarkeit sollte daher der Zufallszahlengenerator gesetzt werden. Außerdem bietet es sich an verschiedene Startkonfigurationen zu versuchen. in der Funktion <code>kmeans()</code> erfolgt dies durch die Option <code>nstart=</code>. Hier mit <code>k=4</code> Clustern:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1896</span>)

seg.k &lt;-<span class="st"> </span><span class="kw">kmeans</span>(segment.num, <span class="dt">centers =</span> <span class="dv">4</span>, <span class="dt">nstart =</span> <span class="dv">10</span>)
seg.k
<span class="co">#&gt; K-means clustering with 4 clusters of sizes 111, 26, 58, 105</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Cluster means:</span>
<span class="co">#&gt;   Alter Einkommen Kinder Eigenheim Mitgliedschaft  Frau</span>
<span class="co">#&gt; 1  42.9     46049  1.649     0.505         0.1081 0.568</span>
<span class="co">#&gt; 2  56.4     85973  0.385     0.538         0.0385 0.538</span>
<span class="co">#&gt; 3  27.0     22608  1.224     0.276         0.2069 0.414</span>
<span class="co">#&gt; 4  43.6     62600  1.505     0.457         0.1238 0.590</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Clustering vector:</span>
<span class="co">#&gt;   [1] 1 4 4 1 4 4 4 1 2 4 1 1 4 4 1 1 1 1 1 4 4 4 1 4 1 1 1 1 4 1 4 4 1 1 2</span>
<span class="co">#&gt;  [36] 1 4 1 1 4 4 4 1 4 4 4 4 1 1 1 1 1 2 1 1 4 4 4 4 1 4 1 4 1 1 1 1 4 4 4</span>
<span class="co">#&gt;  [71] 4 1 1 4 1 1 4 4 4 4 1 4 1 3 1 4 1 1 1 1 4 4 4 1 1 4 1 4 4 4 3 3 3 3 3</span>
<span class="co">#&gt; [106] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span>
<span class="co">#&gt; [141] 3 3 3 3 3 3 3 3 3 3 1 2 4 2 2 4 1 1 2 2 4 4 1 1 4 2 4 4 1 2 2 3 4 1 2</span>
<span class="co">#&gt; [176] 2 4 2 3 4 4 4 1 1 1 1 1 1 4 3 1 4 4 4 4 1 1 1 2 4 4 1 2 4 4 1 4 2 1 2</span>
<span class="co">#&gt; [211] 4 3 4 2 2 4 2 1 4 3 1 2 2 4 2 4 4 1 4 4 1 1 1 1 1 3 1 1 4 1 4 3 1 4 1</span>
<span class="co">#&gt; [246] 4 1 4 1 4 4 4 4 1 1 1 4 4 1 1 1 1 1 1 4 1 1 1 1 1 2 4 4 1 4 1 1 1 1 2</span>
<span class="co">#&gt; [281] 4 4 4 4 1 4 1 4 4 4 1 4 1 4 1 4 1 1 4 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Within cluster sum of squares by cluster:</span>
<span class="co">#&gt; [1] 3.18e+09 2.22e+09 1.69e+09 2.81e+09</span>
<span class="co">#&gt;  (between_SS / total_SS =  90.6 %)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Available components:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;    </span>
<span class="co">#&gt; [5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;        </span>
<span class="co">#&gt; [9] &quot;ifault&quot;</span></code></pre></div>
<p>Neben der Anzahl Beobachtungen im Cluster (z. B. 26 in Cluster 2) werden auch die Clusterzentren ausgegeben. Diese können dann direkt verglichen werden. Sie sehen z. B., dass das Durchschnittsalter in Cluster 3 mit 27 am geringsten ist. Der Anteil der Eigenheimbesitzer ist mit 54 % in Cluster 2 am höchsten.</p>
<p>Einen Plot der Scores auf den beiden ersten Hauptkomponenten können Sie über die Funktion <code>clusplot()</code> aus dem Paket <code>cluster</code> erhalten.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clusplot</span>(segment.num, seg.k$cluster, 
         <span class="dt">color =</span> <span class="ot">TRUE</span>, <span class="dt">shade =</span> <span class="ot">TRUE</span>, <span class="dt">labels =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="082_Clusteranalyse_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /> Wie schon im deskriptiven Ergebnis: Die Cluster <code>1</code> und <code>4</code> unterscheiden sich (in den ersten beiden Hauptkomponenten) nicht wirklich. Vielleicht sollten dies noch zusammengefasst werden, d. h., mit <code>centers=3</code> die Analyse wiederholt werden?<a href="#fn63" class="footnoteRef" id="fnref63"><sup>63</sup></a></p>
<hr />
</div>
<div id="ubung-b3-datensatz" class="section level2">
<h2><span class="header-section-number">14.7</span> Übung: B3 Datensatz</h2>
<p>Der B3 Datensatz <em>Heilemann, U. and Münch, H.J. (1996): West German Business Cycles 1963-1994: A Multivariate Discriminant Analysis. CIRET–Conference in Singapore, CIRET–Studien 50.</em> enthält Quartalsweise Konjunkturdaten aus (West-)Deutschland.</p>
<p>Er kann von <a href="https://goo.gl/0YCEHf" class="uri">https://goo.gl/0YCEHf</a> heruntergeladen werden.</p>
<ol style="list-style-type: decimal">
<li>Wenn die Konjunkturphase <code>PHASEN</code> nicht berücksichtigt wird, wie viele Cluster könnte es geben? Ändert sich das Ergebnis, wenn die Variablen standardisiert werden?</li>
<li>Führen Sie eine k-Means Clusteranalyse mit 4 Clustern durch. Worin unterscheiden sich die gefundenen Segmente?</li>
</ol>
</div>
<div id="literatur-3" class="section level2">
<h2><span class="header-section-number">14.8</span> Literatur</h2>
<ul>
<li>Chris Chapman, Elea McDonnell Feit (2015): <em>R for Marketing Research and Analytics</em>, Kapitel 11.3</li>
<li>Reinhold Hatzinger, Kurt Hornik, Herbert Nagel (2011): <em>R – Einführung durch angewandte Statistik</em>. Kapitel 12</li>
</ul>
</div>
<div id="verweise-6" class="section level2">
<h2><span class="header-section-number">14.9</span> Verweise</h2>
<ul>
<li><p>Diese Übung orientiert sich am Beispiel aus Kapitel 11.3 aus <span class="citation">Chapman und Feit (<a href="#ref-Chapman2015">2015</a>)</span> und steht unter der Lizenz <a href="http://creativecommons.org/licenses/by-sa/3.0">Creative Commons Attribution-ShareAlike 3.0 Unported</a>. Der Code steht unter der <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache Lizenz 2.0</a></p></li>
<li><p>Der erste Teil dieser Übung basiert auf diesem Skript: <a href="https://cran.r-project.org/web/packages/broom/vignettes/kmeans.html" class="uri">https://cran.r-project.org/web/packages/broom/vignettes/kmeans.html</a></p></li>
<li><p>Eine weiterführende, aber gut verständliche Einführung findet sich bei <span class="citation">James, Witten, Hastie, und Tibshirani (<a href="#ref-james2013introduction">2013</a><a href="#ref-james2013introduction">c</a>)</span>.</p></li>
<li><p>Die Intuition zum euklidischen Abstand mit Pythagoras’ Satz kann hier im Detail nachgelesen werden: <a href="https://betterexplained.com/articles/measure-any-distance-with-the-pythagorean-theorem/" class="uri">https://betterexplained.com/articles/measure-any-distance-with-the-pythagorean-theorem/</a>.</p></li>
</ul>

</div>
</div>
<h3>Literaturverzeichnis</h3>
<div id="refs" class="references">
<div id="ref-Chapman2015">
<p>Chapman, Chris, und Elea McDonnell Feit. 2015. <em>R for Marketing Research and Analytics</em>. Springer International Publishing. doi:<a href="https://doi.org/10.1007/978-3-319-14436-8">10.1007/978-3-319-14436-8</a>.</p>
</div>
<div id="ref-james2013introduction">
<p>James, Gareth, Daniela Witten, Trevor Hastie, und Robert Tibshirani. 2013c. <em>An introduction to statistical learning</em>. Bd. 6. Springer.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="63">
<li id="fn63"><p>Das Paket <code>NbClust</code>, siehe Malika Charrad, Nadia Ghazzali, Veronique Boiteau, Azam Niknafs (2014) <em>NbClust: An R Package for Determining the Relevant Number of Clusters in a Data Set</em>, Journal of Statistical Software, 61(6), 1-36. <a href="http://dx.doi.org/10.18637/jss.v061.i06" class="uri">http://dx.doi.org/10.18637/jss.v061.i06</a>, bietet viele Möglichkeiten die Anzahl der Cluster optimal zu bestimmen.<a href="vertiefung-clusteranalyse.html#fnref63">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="iv-ungeleitetes-modellieren.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vi-anhang.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
