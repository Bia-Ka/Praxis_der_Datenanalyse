<!DOCTYPE html>
<html  lang="de-De">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Praxis der Datenanalyse</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Eine Einführung in moderne Statistik für Praktiker">
  <meta name="generator" content="bookdown 0.2.3 and GitBook 2.6.7">

  <meta property="og:title" content="Praxis der Datenanalyse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="cover.jpg" />
  <meta property="og:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="github-repo" content="sebastiansauer/Praxis_der_Datenanalyse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Praxis der Datenanalyse" />
  
  <meta name="twitter:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="twitter:image" content="cover.jpg" />

<meta name="author" content="Sebastian Sauer, Matthias Gehrke, Karsten Lübke, Oliver Gansser">


<meta name="date" content="2017-04-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="einstieg-in-ggplot2-qplot.html">
<link rel="next" href="die-gefuhlswelt-von-ggplot2.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Praxis der Datenanalyse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="haufige-arten-von-diagrammen" class="section level2">
<h2><span class="header-section-number">7.4</span> Häufige Arten von Diagrammen</h2>
<p>Unter den vielen Arten von Diagrammen und vielen Arten, diese zu klassifizieren greifen wir uns ein paar häufige Diagramme heraus und schauen uns diese der Reihe nach an.</p>
<div id="eine-kontinuierliche-variable" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Eine kontinuierliche Variable</h3>
<p>Schauen wir uns die Verteilung der Schuhgrößen von Studierenden an.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/wo_men.csv&quot;</span>)

<span class="kw">qplot</span>(<span class="dt">x =</span> shoe_size, <span class="dt">data =</span> wo_men)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Weisen wir nur der X-Achse (aber nicht der Y-Achse) eine kontinuierliche Variable zu, so wählt <code>ggplot2</code> automatisch als Geom automatisch ein Histogramm; wir müssen daher nicht explizieren, dass wir ein Histogramm als Geom wünschen (aber wir könnten es hinzufügen). Alternativ wäre ein Dichtediagramm hier von Interesse:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># qplot(x = shoe_size, data = wo_men)  wie oben</span>

<span class="kw">qplot</span>(<span class="dt">x =</span> shoe_size, <span class="dt">data =</span> wo_men, <span class="dt">geom =</span> <span class="st">&quot;density&quot;</span>)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Was man sich merken muss, ist, dass hier nur das Geom mit Anführungsstrichen zu benennen ist, die übrigen Parameter <em>ohne</em>.</p>
<p>Vielleicht wäre es noch schön, beide Geome zu kombinieren in einem Diagramm. Das ist etwas komplizierter; wir müssen zum großen Bruder <code>ggplot</code> umsteigen, da <code>qplot</code> nicht diese Funktionen anbietet.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> wo_men) +
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> shoe_size) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..), <span class="dt">alpha =</span> .<span class="dv">7</span>) +
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Zuerst haben wir mit dem Parameter <code>data</code> den Dataframe benannt. <code>aes</code> definiert, welche Variablen welchen Achsen (oder auch z.B. Füllfarben) zugewiesen werden. Hier sagen wir, dass die Schuhgröße auf X-Achse stehen soll. Das <code>+</code>-Zeichen trennt die einzelnen Bestandteile des <code>ggplot</code>-Aufrufs voneinander. Als nächstes sagen wir, dass wir gerne ein Histogram hätten: <code>geom_histogram</code>. Dabei soll aber nicht wie gewöhnlich auf der X-Achse die Häufigkeit stehen, sondern die Dichte. <code>ggplot</code> berechnet selbständig die Dichte und nennt diese Variable <code>..density..</code>; die vielen Punkte sollen wohl klar machen, dass es sich nicht um eine “normale” Variable aus dem eigenen Datenframe handelt, sondern um eine “interne” Variable von <code>ggplot</code> - die wir aber nichtsdestotrotz verwenden können. <code>alpha</code> bestimmt die “Durchsichtigkeit” eines Geoms; spielen Sie mal etwas damit herum. Schließlich malen wir noch ein blaues Dichtediagramm <em>über</em> das Histogramm.</p>
<p>Wünsche sind ein Fass ohne Boden… Wäre es nicht schön, ein Diagramm für Männer und eines für Frauen zu haben, um die Verteilungen vergleichen zu können?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(<span class="dt">x =</span> shoe_size, <span class="dt">data =</span> wo_men, <span class="dt">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">color =</span> sex)
<span class="kw">qplot</span>(<span class="dt">x =</span> shoe_size, <span class="dt">data =</span> wo_men, <span class="dt">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">fill =</span> sex, <span class="dt">alpha =</span> <span class="kw">I</span>(.<span class="dv">7</span>))</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-9-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Hier sollten vielleicht noch die Extremwerte entfernt werden, um den Blick auf das Gros der Werte nicht zu verstellen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(shoe_size &lt;=<span class="st"> </span><span class="dv">47</span>) -&gt;<span class="st"> </span>wo_men2

<span class="kw">qplot</span>(<span class="dt">x =</span> shoe_size, <span class="dt">data =</span> wo_men2, <span class="dt">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">fill =</span> sex, <span class="dt">alpha =</span> <span class="kw">I</span>(.<span class="dv">7</span>))</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Besser. Man kann das Durchpfeifen auch bis zu <code>qplot</code> weiterführen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(shoe_size &lt;=<span class="st"> </span><span class="dv">47</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> shoe_size, <span class="dt">data =</span> ., <span class="dt">geom =</span> <span class="st">&quot;density&quot;</span>, <span class="dt">fill =</span> sex, <span class="dt">alpha =</span> <span class="kw">I</span>(.<span class="dv">7</span>))</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Die Pfeife versucht im Standard, das Endprodukt des letzten Arbeitsschritts an den <em>ersten</em> Parameter des nächsten Befehls weiterzugeben. Ein kurzer Blick in die Hilfe von <code>qplot</code> zeigt, dass der erste Parameter nicht <code>data</code> ist, sondern <code>x</code>. Daher müssen wir explizit sagen, an welchen Parameter wir das Endprodukt des letzen Arbeitsschritts geben wollen. Netterweise müssen wir dafür nicht viel tippen: Mit einem schlichten Punkt <code>.</code> können wir sagen “nimm den Dataframe, so wie er vom letzten Arbeitsschritt ausgegeben wurde”.</p>
<p>Mit <code>fill = sex</code> sagen wir <code>qplot</code>, dass er für Männer und Frauen jeweils ein Dichtediagramm erzeugen soll; jedem Dichtediagramm wird dabei eine Farbe zugewiesen (die uns <code>ggplot2</code> im Standard voraussucht). Mit anderen Worten: Die Werte von <code>sex</code> werden der Füllfarbe der Histogramme zugeordnet. Anstelle der Füllfarbe hätten wir auch die Linienfarbe verwenden können; die Syntax wäre dann: <code>color = sex</code>.</p>
</div>
<div id="zwei-kontinuierliche-variablen" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Zwei kontinuierliche Variablen</h3>
<p>Ein Streudiagramm ist die klassische Art, zwei metrische Variablen darzustellen. Das ist mit <code>qplot</code> einfach:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size, <span class="dt">data =</span> wo_men)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Wir weisen wieder der X-Achse und der Y-Achse eine Variable zu; handelt es sich in beiden Fällen um Zahlen, so wählt <code>ggplot2</code> automatisch ein Streudiagramm - d.h. Punkte als Geom (<code>geom = &quot;point&quot;</code>). Wir sollten aber noch die Extremwerte herausnehmen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size, <span class="dt">data =</span> .)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Der Trend ist deutlich erkennbar: Je größer die Person, desto länger die Füß´. Zeichnen wir noch eine Trendgerade ein.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size, <span class="dt">data =</span> .) +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Synonym könnten wir auch schreiben:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() +
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p>Da <code>ggplot</code> als <em>ersten</em> Parameter die Daten erwartet, kann die Pfeife hier problemlos durchgereicht werden. <em>Innerhalb</em> eines <code>ggplot</code>-Aufrufs werden die einzelne Teile durch ein Pluszeichen <code>+</code> voneinander getrennt. Nachdem wir den Dataframe benannt haben, definieren wir die Zuweisung der Variablen zu den Achsen mit <code>aes</code> (“aes” wie “aesthetics”, also das “Sichtbare” eines Diagramms, die Achsen etc., werden definiert). Ein “Smooth-Geom” ist eine Linie, die sich schön an die Punkte anschmiegt, in diesem Falls als Gerade (lineares Modell, <code>lm</code>).</p>
<p>Bei sehr großen Datensätze, sind Punkte unpraktisch, da sie sich überdecken (“overplotting”). Ein Abhilfe ist es, die Punkte nur “schwach” zu färben. Dazu stellt man die “Füllstärke” der Punkte über <code>alpha</code> ein: <code>geom_point(alpha = 1/100)</code>. Um einen passablen Alpha-Wert zu finden, bedarf es häufig etwas Probierens. Zu beachten ist, dass es mitunter recht lange dauert, wenn <code>ggplot</code> viele (&gt;100.000) Punkte malen soll.</p>
<p>Bei noch größeren Datenmengen bietet sich an, den Scatterplot als “Schachbrett” aufzufassen, und das Raster einzufärben, je nach Anzahl der Punkte pro Schachfeld; zwei Geome dafür sind <code>geom_hex()</code> und <code>geom_bin2d()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(flights, <span class="dt">package =</span> <span class="st">&quot;nycflights13&quot;</span>)
<span class="kw">nrow</span>(flights)  <span class="co"># groß!</span>
<span class="co">#&gt; [1] 336776</span>

<span class="kw">ggplot</span>(flights) +
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> distance, <span class="dt">y =</span> air_time) +
<span class="st">  </span><span class="kw">geom_hex</span>()</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/flights_hexbin-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Wenn man dies verdaut hat, wächst der Hunger nach einer Aufteilung in Gruppen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
wo_men &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/wo_men.csv&quot;</span>)

wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) -&gt;<span class="st"> </span>wo_men2

wo_men2 %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size, <span class="dt">color =</span> sex, <span class="dt">data =</span> .)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/fig-aes-color-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Mit <code>color = sex</code> sagen wir, dass die Linienfarbe (der Punkte) entsprechend der Stufen von <code>sex</code> eingefärbt werden sollen. Die genaue Farbwahl übernimmt <code>ggplot2</code> für uns.</p>
<p>Alternativ kann man auch zwei “Teil-Bildchen” (“facets”) erstellen, eines für Frauen und eines für Männer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span>dplyr::<span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size, <span class="dt">facets =</span> <span class="st">&quot;~sex&quot;</span>, <span class="dt">color =</span> sex, <span class="dt">data =</span> .)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-16-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Man beachte die Tilde <code>~</code>, die vor die “Gruppierungsvariable” <code>sex</code> zu setzen ist.</p>
<div id="vertiefung-zu-facetten" class="section level4">
<h4><span class="header-section-number">7.4.2.1</span> Vertiefung zu Facetten</h4>
<p>Ein netter visueller Effekt wird erreicht, wenn in jeder Facette zwar alle Punkte gezeigt werden in einem leichten Grau. Aber farbig betont werden nur die Punkte, die zur jeweiligen Gruppe gehören. Der optische Eindruck erklärt es einfacher als Worte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span>dplyr::<span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span>dplyr::<span class="kw">select</span>(-sex) -&gt;<span class="st"> </span>wo_men4

wo_men4 %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(ggplot2::<span class="kw">aes</span>(<span class="dt">x =</span> height, <span class="dt">y =</span> shoe_size)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;grey80&quot;</span>) +
<span class="st">  </span><span class="co">#facet_wrap(~sex) +</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> wo_men2, ggplot2::<span class="kw">aes</span>(<span class="dt">color =</span> sex))
  </code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Der “ggplot-Trick” ist, zuerst die Punkte <em>ohne</em> Gruppierungsinformation (hier: <code>sex</code>) zu plotten. Danach plotten wir die nach Gruppenzugehörigkeit gefärbten Punkte.</p>
</div>
</div>
<div id="eine-diskrete-variable" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Eine diskrete Variable</h3>
<p>Bei diskreten Variablen, vor allem nominalen Variablen, geht es in der Regel darum, Häufigkeiten auszuzählen. Wie viele Männer und Frauen sind in dem Datensatz?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(<span class="dt">x =</span> sex, <span class="dt">data =</span> wo_men)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Falls nur die X-Achse definiert ist und dort eine Faktorvariable oder eine Text-Variable steht, dann nimmt <code>qplot</code> automatisch ein Balkendiagramm als Geom.</p>
<p>Entfernen wir vorher noch die fehlenden Werte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">na.omit</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> sex, <span class="dt">data =</span> .)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Wir könnten uns jetzt die Frage stellen, wie viele kleine und viele große Menschen es bei Frauen und bei den Männern gibt. Dazu müssen wir zuerst eine Variable wie “Größe gruppiert” erstellen mit zwei Werten: “klein” und “groß”. Nennen wir sie <code>groesse_gruppe</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men$groesse_gruppe &lt;-<span class="st"> </span>car::<span class="kw">recode</span>(wo_men$height, <span class="st">&quot;lo:175 = &#39;klein&#39;; else = &#39;gross&#39;&quot;</span>)

wo_men %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(height &gt;<span class="st"> </span><span class="dv">150</span>, height &lt;<span class="st"> </span><span class="dv">210</span>, shoe_size &lt;<span class="st"> </span><span class="dv">55</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span>na.omit -&gt;<span class="st"> </span>wo_men2
  
<span class="kw">qplot</span>(<span class="dt">x =</span> sex, <span class="dt">fill =</span> groesse_gruppe, <span class="dt">data =</span> wo_men2)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In Worten sagt der <code>recode</code>-Befehl hier in etwa: “Kodiere <code>wo_men$height</code> um, und zwar vom kleinsten (<code>lo</code>) Wert bis 170 soll den Wert <code>klein</code> bekommen, ansonsten bekommt eine Größe den Wert <code>gross</code>”.</p>
<p>Hier haben wir <code>qplot</code> gesagt, dass der die Balken entsprechend der Häufigkeit von <code>groesse_gruppe</code> füllen soll. Und bei den Frauen sind bei dieser Variablen die Werte <code>klein</code> häufig; bei den Männern hingegen die Werte <code>gross</code>.</p>
<p>Schön wäre noch, wenn die Balken Prozentwerte angeben würden. Das geht mit <code>qplot</code> (so) nicht; wir schwenken auf <code>ggplot</code> um<a href="#fn41" class="footnoteRef" id="fnref41"><sup>41</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men2 %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() +
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> sex, <span class="dt">fill =</span> groesse_gruppe) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Schauen wir uns die Struktur des Befehls <code>ggplot</code> näher an.</p>

<div class="rmdpseudocode">
<p><code>wo_men2</code>: Hey R, nimm den Datensatz <code>wo_men2</code> UND DANN…<br />
<code>ggpplot()</code> : Hey R, male ein Diagramm von Typ ggplot (mit dem Datensatz aus dem vorherigen Pfeifen-Schritt, d.h. aus der vorherigen Zeile, also <code>wo_men2</code>)!<br />
<code>+</code>: Das Pluszeichen grenzt die Teile eines ggplot-Befehls voneinander ab.<br />
<code>aes</code>: von “aethetics”, also welche Variablen des Datensatzes den sichtbaren Aspekten (v.a. Achsen, Farben) zugeordnet werden.<br />
<code>x</code>: Der X-Achse (Achtung, <code>x</code> wird klein geschrieben hier) wird die Variable <code>sex</code> zugeordnet.<br />
<code>y</code>: gibt es nicht??? Wenn in einem ggplot-Diagramm <em>keine</em> Y-Achse definiert wird, wird ggplot automatisch ein Histogramm bzw. ein Balkendiagramm erstellen. Bei diesen Arten von Diagrammen steht auf der Y-Achse keine eigene Variable, sondern meist die Häufigkeit des entsprechenden X-Werts (oder eine Funktion der Häufigkeit, wie relative Häufigkeit).<br />
<code>fill</code> Das Diagramm (die Balken) sollen so gefüllt werden, dass sich die Häufigkeit der Werte von <code>groesse_gruppe</code> darin widerspiegelt.</p>
<p><code>geom_XYZ</code>: Als “Geom” soll ein Balken (“bar”) gezeichnet werden. Ein Geom ist in ggplot2 das zu zeichnende Objekt, also ein Boxplot, ein Balken, Punkte, Linien etc. Entsprechend wird gewünschte Geom mit <code>geom_bar</code>, <code>geom_boxplot</code>, geom_point` etc. gewählt.</p>
<p><code>position = fill</code>: <code>position_fill</code> will sagen, dass die Balken alls eine Höhe von 100% (1) haben. Die Balken zeigen also nur die Anteile der Werte der <code>fill</code>-Variablen.</p>
</div>
<p></p>
<p>Die einzige Änderung in den Parametern ist <code>position = &quot;fill&quot;</code>. Dieser Parameter weist <code>ggplot</code> an, die Positionierung der Balken auf die Darstellung von Anteilen auszulegen. Damit haben alle Balken die gleiche Höhe, nämlich 100% (1). Aber die “Füllung” der Balken schwankt je nach der Häufigkeit der Werte von <code>groesse_gruppe</code> pro Balken (d.h. pro Wert von <code>sex</code>).</p>
<p>Wir sehen, dass die Anteile von großen bzw. kleinen Menschen bei den beiden Gruppen (Frauen vs. Männer) <em>unterschiedlich hoch</em> ist. Dies spricht für einen <em>Zusammenhang</em> der beiden Variablen; man sagt, die Variablen sind <em>abhängig</em> (im statistischen Sinne).</p>
<blockquote>
<p>Je unterschiedlicher die “Füllhöhe”, desto stärker sind die Variablen (X-Achse vs. Füllfarbe) voneinander abhängig (bzw. desto stärker der Zusammenhang).</p>
</blockquote>
</div>
<div id="zwei-diskrete-variablen" class="section level3">
<h3><span class="header-section-number">7.4.4</span> Zwei diskrete Variablen</h3>
<p>Arbeitet man mit nominalen Variablen, so sind Kontingenztabellen Täglich Brot. Z.B.: Welche Produkte wurden wie häufig an welchem Standort verkauft? Wie ist die Verteilung von Alkoholkonsum und Körperform bei Menschen einer Single-Börse. Bleiben wir bei letztem Beispiel.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(profiles, <span class="dt">package =</span> <span class="st">&quot;okcupiddata&quot;</span>)

profiles %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(drinks, body_type) %&gt;%<span class="st"> </span>
<span class="st">  </span>ggplot +
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> drinks, <span class="dt">y =</span> body_type, <span class="dt">fill =</span> n) +
<span class="st">  </span><span class="kw">geom_tile</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>))</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Was haben wir gemacht? Also:</p>

<div class="rmdpseudocode">
<p>Nehme den Datensatz “profiles” UND DANN<br />
Zähle die Kombinationen von “drinks” und “body_type” UND DANN<br />
Erstelle ein ggplot-Plot UND DANN<br />
Weise der X-Achse “drinks” zu, der Y-Achse “body_type” und der Füllfarbe “n” UND DANN<br />
Male Fliesen UND DANN<br />
Passe das Thema so an, dass der Winkel für Text der X-Achse auf 90 Grad steht.</p>
</div>
<p></p>
<p>Was sofort ins Auge sticht, ist dass “soziales Trinken”, nennen wir es mal so, am häufigsten ist, unabhängig von der Körperform. Ansonsten scheinen die Zusammenhäng nicht sehr stark zu sein.</p>
</div>
<div id="zusammenfassungen-zeigen" class="section level3">
<h3><span class="header-section-number">7.4.5</span> Zusammenfassungen zeigen</h3>
<p>Manchmal möchten wir <em>nicht</em> die Rohwerte einer Variablen darstellen, sondern z.B. die Mittelwerte pro Gruppe. Mittelwerte sind eine bestimmte <em>Zusammenfassung</em> einer Spalte; also fassen wir zuerst die Körpergröße zum Mittelwert zusammen - gruppiert nach Geschlecht.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men2 %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(sex) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Groesse_MW =</span> <span class="kw">mean</span>(height)) -&gt;<span class="st"> </span>wo_men3

wo_men3
<span class="co">#&gt; # A tibble: 2 × 2</span>
<span class="co">#&gt;      sex Groesse_MW</span>
<span class="co">#&gt;   &lt;fctr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1    man        183</span>
<span class="co">#&gt; 2  woman        167</span></code></pre></div>
<p>Diese Tabelle schieben wir jetzt in <code>ggplot2</code>; natürlich hätten wir das gleich in einem Rutsch durchpfeifen können.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men3 %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> sex, <span class="dt">y =</span> Groesse_MW, <span class="dt">data =</span> .)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Das Diagramm besticht nicht durch die Tiefe und Detaillierung. Wenn wir noch zusätzlich die Mittelwerte nach <code>Groesse_Gruppe</code> ausweisen, wird das noch überschaubar bleiben.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wo_men2 %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(sex, groesse_gruppe) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Groesse_MW =</span> <span class="kw">mean</span>(height)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">qplot</span>(<span class="dt">x =</span> sex, <span class="dt">color =</span> <span class="kw">factor</span>(groesse_gruppe), <span class="dt">y =</span> Groesse_MW, <span class="dt">data =</span> .)</code></pre></div>
<p><img src="050_Daten_visualisieren_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="41">
<li id="fn41"><p>Cleveland fände diese Idee nicht so gut.<a href="haufige-arten-von-diagrammen.html#fnref41">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="einstieg-in-ggplot2-qplot.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="die-gefuhlswelt-von-ggplot2.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
