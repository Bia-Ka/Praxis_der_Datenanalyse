<!DOCTYPE html>
<html  lang="de-De">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Praxis der Datenanalyse</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Eine Einführung in moderne Statistik für Praktiker">
  <meta name="generator" content="bookdown 0.2.3 and GitBook 2.6.7">

  <meta property="og:title" content="Praxis der Datenanalyse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="cover.jpg" />
  <meta property="og:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="github-repo" content="sebastiansauer/Praxis_der_Datenanalyse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Praxis der Datenanalyse" />
  
  <meta name="twitter:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="twitter:image" content="cover.jpg" />

<meta name="author" content="Sebastian Sauer, Matthias Gehrke, Karsten Lübke, Oliver Gansser">


<meta name="date" content="2017-04-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="daten-aufbereiten-mit-dplyr.html">
<link rel="next" href="befehlsubersicht-2.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Praxis der Datenanalyse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="die-pfeife" class="section level2">
<h2><span class="header-section-number">4.3</span> Die Pfeife</h2>
<p>Die zweite Idee kann man salopp als “Durchpfeifen” oder die “Idee der Pfeife bezeichnen; ikonographisch mit einem Pfeifen ähnlichen Symbol dargestellt <code>%&gt;%</code>. Der Begriff”Durchpfeifen&quot; ist frei vom Englischen “to pipe” übernommen. Das berühmte Bild von René Magritte stand dabei Pate.</p>
<div class="figure" style="text-align: center"><span id="fig:cecie-une-pipe"></span>
<img src="images/Datenjudo/ma-150089-WEB.jpg" alt="La trahison des images [Ceci n'est pas une pipe], René Magritte, 1929, © C. Herscovici, Brussels / Artists Rights Society (ARS), New York, http://collections.lacma.org/node/239578" width="70%" />
<p class="caption">
Abbildung 4.8: La trahison des images [Ceci n’est pas une pipe], René Magritte, 1929, © C. Herscovici, Brussels / Artists Rights Society (ARS), New York, <a href="http://collections.lacma.org/node/239578" class="uri">http://collections.lacma.org/node/239578</a>
</p>
</div>
<p>Hierbei ist gemeint, einen Datensatz sozusagen auf ein Fließband zu legen und an jedem Arbeitsplatz einen Arbeitsschritt auszuführen. Der springende Punkt ist, dass ein Dataframe als “Rohstoff” eingegeben wird und jeder Arbeitsschritt seinerseits wieder einen Datafram ausgiebt. Damit kann man sehr schön, einen “Flow” an Verarbeitung erreichen, außerdem spart man sich Tipparbeit und die Syntax wird lesbarer. Damit das Durchpfeifen funktioniert, benötigt man Befehle, die als Eingabe einen Dataframe erwarten und wieder einen Dataframe zurückliefern. Das Schaubild verdeutlich beispielhaft eine Abfolge des Durchpfeifens.</p>
<div class="figure" style="text-align: center"><span id="fig:fig-durchpreifen"></span>
<img src="images/Datenjudo/durchpfeifen.pdf" alt="Das 'Durchpeifen'" width="80%" />
<p class="caption">
Abbildung 4.9: Das ‘Durchpeifen’
</p>
</div>
<p>Die sog. “Pfeife” (pipe: <code>%&gt;%</code>) in Anspielung an das berühmte Bild von René Magritte, verkettet Befehle hintereinander. Das ist praktisch, da es die Syntax vereinfacht. Vergleichen Sie mal diese Syntax</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(<span class="kw">summarise</span>(<span class="kw">group_by</span>(<span class="kw">filter</span>(stats_test, !<span class="kw">is.na</span>(score)), interest), <span class="dt">mw =</span> <span class="kw">mean</span>(score)), mw &gt;<span class="st"> </span><span class="dv">30</span>)</code></pre></div>
<p>mit dieser</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stats_test %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(score)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(interest) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mw =</span> <span class="kw">mean</span>(score)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(mw &gt;<span class="st"> </span><span class="dv">30</span>)
<span class="co">#&gt; # A tibble: 4 × 2</span>
<span class="co">#&gt;   interest    mw</span>
<span class="co">#&gt;      &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1        3  30.8</span>
<span class="co">#&gt; 2        5  32.5</span>
<span class="co">#&gt; 3        6  34.0</span>
<span class="co">#&gt; 4       NA  33.1</span></code></pre></div>
<p>Es ist hilfreich, diese “Pfeifen-Syntax” in deutschen Pseudo-Code zu übersetzen.</p>

<div class="rmdpseudocode">
<p>Nimm die Tabelle “stats_test” UND DANN<br />
filtere alle nicht-fehlenden Werte UND DANN<br />
gruppiere die verbleibenden Werte nach “interest” UND DANN<br />
bilde den Mittelwert (pro Gruppe) für “score” UND DANN<br />
liefere nur die Werte größer als 30 zurück.</p>
</div>
<p></p>
<p>Die zweite Syntax, in “Pfeifenform” ist viel einfacher zu verstehen als die erste! Die erste Syntax ist verschachelt, man muss sie von innen nach außen lesen. Das ist kompliziert. Die Pfeife in der 2. Syntax macht es viel einfacher, die Snytax zu verstehen, da die Befehle “hintereinander” gestellt (sequenziell organisiert) sind.</p>
<p>Die Pfeife zerlegt die “russische Puppe”, also ineinander verschachelteten Code, in sequenzielle Schritte und zwar in der richtigen Reihenfolge (entsprechend der Abarbeitung). Wir müssen den Code nicht mehr von innen nach außen lesen (wie das bei einer mathematischen Formel der Fall ist), sondern können wie bei einem Kochrezept “erstens …, zweitens .., drittens …” lesen. Die Pfeife macht die Syntax einfacher. Natürlich hätten wir die verschachtelte Syntax in viele einzelne Befehle zerlegen können und jeweils eine Zwischenergebnis speichern mit dem Zuweisungspfeil <code>&lt;-</code> und das Zwischenergebnis dann explizit an den nächsten Befehl weitergeben. Eigentlich macht die Pfeife genau das - nur mit weniger Tipparbeit. Und auch einfacher zu lesen. Flow!</p>

<div class="rmdcaution">
<p>Wenn Sie Befehle verketten mit der Pfeife, sind nur Befehle erlaubt, die einen Datensatz als Eingabe verlangen und einen Datensatz ausgeben. Das ist bei den hier vorgestellten Funktionen der Fall. Viele andere Funktionen erfüllen dieses Kriterium aber nicht; in dem Fall liefert <code>dplyr</code> eine Fehlermeldung.</p>
</div>
<p></p>
<div id="spalten-berechnen-mit-mutate" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Spalten berechnen mit <code>mutate</code></h3>
<p>Wenn man die Pfeife benutzt, ist der Befehl <code>mutate</code> ganz praktisch: Er berechnet eine Spalte. Normalerweise kann man einfach eine Spalte berechnen mit dem Zuweisungsoperator:</p>
<p>Zum Beispiel so:</p>
<pre><code>df$neue_spalte &lt;- df$spalte1 + df$spalte2</code></pre>
<p>Innerhalb einer Pfeifen-Syntax geht das aber nicht (so gut). Da ist man mit der Funtion <code>mutate</code> besser beraten; <code>mutate</code> leistest just dasselbe wie die Pseudo-Syntax oben:</p>
<pre><code>df %&gt;% 
  mutate(neue_spalte = spalte1 + spalte2)</code></pre>
<p>In Worten:</p>

<div class="rmdpseudocode">
<p>Nimm die Tabelle “df” UND DANN<br />
bilde eine neue Spalte mit dem Namen <code>neue_spalte</code>, die sich berechnet als Summe von <code>spalte1</code> und <code>spalte2</code>.</p>
</div>
<p></p>
<p>Allerdings berücksichtigt <code>mutate</code> auch Gruppierungen. Der Hauptvorteil ist die bessere Lesbarkeit durch Auflösen der Verschachtelungen.</p>
<p>Ein konkretes Beispiel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stats_test %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bestanden =</span> score &gt;<span class="st"> </span><span class="dv">25</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>()
<span class="co">#&gt;   X                 V_1 study_time self_eval interest score bestanden</span>
<span class="co">#&gt; 1 1 05.01.2017 13:57:01          5         8        5    29      TRUE</span>
<span class="co">#&gt; 2 2 05.01.2017 21:07:56          3         7        3    29      TRUE</span>
<span class="co">#&gt; 3 3 05.01.2017 23:33:47          5        10        6    40      TRUE</span>
<span class="co">#&gt; 4 4 06.01.2017 09:58:05          2         3        2    18     FALSE</span>
<span class="co">#&gt; 5 5 06.01.2017 14:13:08          4         8        6    34      TRUE</span>
<span class="co">#&gt; 6 6 06.01.2017 14:21:18         NA        NA       NA    39      TRUE</span></code></pre></div>
<p>Diese Syntax erzeugt eine neue Spalte innerhalb von <code>stats_test</code>; diese Spalte prüft pro Persion, ob <code>score</code> &gt; 25 ist. Falls ja (TRUE), dann ist <code>bestanden</code> TRUE, ansonsten ist <code>bestanden</code> FALSE (Pech). <code>head</code> zeigt die ersten 6 Zeilen des resultierenden Dataframes an.</p>
<p>Ein Sinnbild für <code>mutate</code>:</p>
<p><img src="images/mutate.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="aufgaben-6" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Aufgaben</h3>
<ol style="list-style-type: decimal">
<li>Entschlüsseln Sie dieses Ungetüm! Übersetzen Sie diese Syntax auf Deutsch:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(nycflights13)
<span class="kw">data</span>(flights)

verspaetung &lt;-
<span class="st">  </span><span class="kw">filter</span>(
    <span class="kw">summarise</span>(
    <span class="kw">group_by</span>(<span class="kw">filter</span>(flights, !<span class="kw">is.na</span>(dep_delay), month)), <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay), <span class="dt">n =</span> <span class="kw">n</span>()), n &gt;<span class="st"> </span><span class="dv">10</span>)
 </code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Entschlüsseln Sie jetzt diese Syntax bzw. übersetzen Sie sie ins Deutsche:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">verspaetung &lt;-<span class="st"> </span>flights %&gt;%<span class="st"> </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(dep_delay)) %&gt;%
<span class="kw">group_by</span>(month) %&gt;%
<span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay), <span class="dt">n =</span> <span class="kw">n</span>()) %&gt;%<span class="st"> </span><span class="kw">filter</span>(n &gt;<span class="st"> </span><span class="dv">10</span>)</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>(schwierig) Die Pfeife bei <code>arr_delay</code></li>
</ol>
<ul>
<li>Übersetzen Sie die folgende Pseudo-Syntax ins ERRRische!</li>
</ul>

<div class="rmdpseudocode">
<p>Nehme den Datensatz <code>flights</code> UND DANN…<br />
Wähle daraus die Spalte <code>arr_delay</code> UND DANN…<br />
Berechne den Mittelwert der Spalte UND DANN…<br />
ziehe vom Mittelwert die Spalte ab UND DANN… quadriere die einzelnen Differenzen UND DANN… bilde davon den Mittelwert.</p>
</div>
<p></p>
<p>Lösung:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(arr_delay) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">arr_delay_delta =</span> arr_delay -<span class="st"> </span><span class="kw">mean</span>(flights$arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">arr_delay_delta_quadrat =</span> arr_delay_delta^<span class="dv">2</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_delay_var =</span> <span class="kw">mean</span>(arr_delay_delta_quadrat, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sqrt</span>(arr_delay_var))
<span class="co">#&gt; # A tibble: 1 × 1</span>
<span class="co">#&gt;   `sqrt(arr_delay_var)`</span>
<span class="co">#&gt;                   &lt;dbl&gt;</span>
<span class="co">#&gt; 1                  44.6</span></code></pre></div>
<ul>
<li><p>Berechnen Sie die sd von <code>arr_delay</code> in <code>flights</code>! Vergleichen Sie sie mit dem Ergebnis der vorherigen Aufgabe!<a href="#fn25" class="footnoteRef" id="fnref25"><sup>25</sup></a></p></li>
<li><p>Was hat die Pfeifen-Syntax oben berechnet?<a href="#fn26" class="footnoteRef" id="fnref26"><sup>26</sup></a></p></li>
</ul>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="25">
<li id="fn25"><p><code>sd(flights$arr_delay, na.rm = TRUE)</code><a href="die-pfeife.html#fnref25">↩</a></p></li>
<li id="fn26"><p>die sd von <code>arr_delay</code><a href="die-pfeife.html#fnref26">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="daten-aufbereiten-mit-dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="befehlsubersicht-2.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
