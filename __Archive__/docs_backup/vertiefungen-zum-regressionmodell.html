<!DOCTYPE html>
<html  lang="de-De">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Praxis der Datenanalyse</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Eine Einführung in moderne Statistik für Praktiker">
  <meta name="generator" content="bookdown 0.2.3 and GitBook 2.6.7">

  <meta property="og:title" content="Praxis der Datenanalyse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="cover.jpg" />
  <meta property="og:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="github-repo" content="sebastiansauer/Praxis_der_Datenanalyse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Praxis der Datenanalyse" />
  
  <meta name="twitter:description" content="Eine Einführung in moderne Statistik für Praktiker" />
  <meta name="twitter:image" content="cover.jpg" />

<meta name="author" content="Sebastian Sauer, Matthias Gehrke, Karsten Lübke, Oliver Gansser">


<meta name="date" content="2017-04-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="modellgute-bei-regressionsmodellen.html">
<link rel="next" href="ubung-teaching-rating.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Praxis der Datenanalyse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vertiefungen-zum-regressionmodell" class="section level2">
<h2><span class="header-section-number">11.7</span> Vertiefungen zum Regressionmodell</h2>
<div id="modellwahl" class="section level3">
<h3><span class="header-section-number">11.7.1</span> Modellwahl</h3>
<p>Das Modell mit allen Variablen des Datensatzes, d. h., mit 6 unabhängigen (<code>LinMod.4</code>) erklärt 47.01% der Variation, das Modell <em>nur</em> mit der Rechnungshöhe als erklärende Variable (<code>LinMod.1</code>) schon 45.66%, der Erklärungszuwachs liegt also gerade einmal bei 1.35 Prozentpunkten. In der Statistik ist die Wahl des <em>richtigen</em> Modells eine der größten Herausforderungen, auch deshalb, weil das wahre Modell in der Regel nicht bekannt ist und es schwer ist, die richtige Balance zwischen Einfachheit und Komplexität zu finden. Aufgrund des Zufalls kann es immer passieren, dass das Modell sich zu sehr an die <em>zufälligen</em> Daten anpasst (Stichwort: Overfitting). Es gibt unzählige Modellwahlmethoden, und leider garantiert keine, dass immer das beste Modell gefunden wird. Eine Möglichkeit ist die sogenannte Schrittweise-Rückwärtsselektion auf Basis des Akaike-Informationskriteriums (AIC)<a href="#fn56" class="footnoteRef" id="fnref56"><sup>56</sup></a>. Diese ist nicht nur recht weit verbreitet - und liefert unter bestimmten Annahmen das “richtige” Modell - sondern in R durch den Befehl <code>step()</code> einfach umsetzbar:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">step</span>(LinMod<span class="fl">.4</span>)
<span class="co">#&gt; Start:  AIC=20.5</span>
<span class="co">#&gt; tip ~ total_bill + size + sex + smoker + day + time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Df Sum of Sq RSS   AIC</span>
<span class="co">#&gt; - day         3       0.6 247  15.1</span>
<span class="co">#&gt; - time        1       0.0 247  18.5</span>
<span class="co">#&gt; - sex         1       0.1 247  18.6</span>
<span class="co">#&gt; - smoker      1       0.4 247  18.9</span>
<span class="co">#&gt; &lt;none&gt;                    247  20.5</span>
<span class="co">#&gt; - size        1       4.1 251  22.5</span>
<span class="co">#&gt; - total_bill  1     101.6 348 102.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=15.1</span>
<span class="co">#&gt; tip ~ total_bill + size + sex + smoker + time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Df Sum of Sq RSS  AIC</span>
<span class="co">#&gt; - time        1       0.0 247 13.1</span>
<span class="co">#&gt; - sex         1       0.0 247 13.2</span>
<span class="co">#&gt; - smoker      1       0.4 248 13.5</span>
<span class="co">#&gt; &lt;none&gt;                    247 15.1</span>
<span class="co">#&gt; - size        1       4.3 251 17.4</span>
<span class="co">#&gt; - total_bill  1     101.7 349 97.2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=13.1</span>
<span class="co">#&gt; tip ~ total_bill + size + sex + smoker</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Df Sum of Sq RSS  AIC</span>
<span class="co">#&gt; - sex         1       0.0 247 11.2</span>
<span class="co">#&gt; - smoker      1       0.4 248 11.5</span>
<span class="co">#&gt; &lt;none&gt;                    247 13.1</span>
<span class="co">#&gt; - size        1       4.3 251 15.4</span>
<span class="co">#&gt; - total_bill  1     103.3 350 96.3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=11.2</span>
<span class="co">#&gt; tip ~ total_bill + size + smoker</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Df Sum of Sq RSS  AIC</span>
<span class="co">#&gt; - smoker      1       0.4 248  9.5</span>
<span class="co">#&gt; &lt;none&gt;                    247 11.2</span>
<span class="co">#&gt; - size        1       4.3 252 13.4</span>
<span class="co">#&gt; - total_bill  1     104.3 351 95.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Step:  AIC=9.53</span>
<span class="co">#&gt; tip ~ total_bill + size</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Df Sum of Sq RSS  AIC</span>
<span class="co">#&gt; &lt;none&gt;                    248  9.5</span>
<span class="co">#&gt; - size        1       5.2 253 12.6</span>
<span class="co">#&gt; - total_bill  1     106.3 354 94.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = tip ~ total_bill + size, data = tips)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)   total_bill         size  </span>
<span class="co">#&gt;      0.6689       0.0927       0.1926</span></code></pre></div>
<p>In den letzten Zeilen der Ausgabe steht das beste Modell, das diese Methode (schrittweise, rückwärts) mit diesem Kriterium (AIC) bei diesen Daten findet (Punktprognose, d. h. ohne Residuum):</p>
<p><code>tip =  0.66894 +  0.09271 * total_bill + 0.19260 * size</code></p>
<p>Der Ausgabe können Sie auch entnehmen, welche Variablen in welcher Reihenfolge <em>entfernt</em> wurden: Zunächst <code>day</code>, dann <code>time</code>, danach <code>sex</code> und schließlich <code>smoker</code>. Hier sind also dieselben Variablen noch im Modell, die auch in <code>LinMod.4</code> signifikant zum Niveau 10% waren, eine Auswahl der dort signifikanten Variablen hätte also dasselbe Modell ergeben. Das ist häufig so, aber nicht immer!</p>
</div>
<div id="interaktionen" class="section level3">
<h3><span class="header-section-number">11.7.2</span> Interaktionen</h3>
<p>Wir haben gesehen, dass es einen Zusammenhang zwischen der Trinkgeldhöhe und der Rechnungshöhe gibt. Vielleicht unterscheidet sich der Zusammenhang je nachdem, ob geraucht wurde, d. h., vielleicht gibt es eine Interaktion (Wechselwirkung). Die kann in <code>lm</code> einfach durch ein <code>*</code> zwischen den unabhängigen Variablen modelliert werden:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">LinMod<span class="fl">.6</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(tip ~<span class="st"> </span>smoker*total_bill, <span class="dt">data =</span> tips)
<span class="kw">summary</span>(LinMod<span class="fl">.6</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = tip ~ smoker * total_bill, data = tips)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt; -2.679 -0.524 -0.120  0.475  4.900 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                      Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)           0.36007    0.20206    1.78  0.07601 .  </span>
<span class="co">#&gt; smokerYes             1.20420    0.31226    3.86  0.00015 ***</span>
<span class="co">#&gt; total_bill            0.13716    0.00968   14.17  &lt; 2e-16 ***</span>
<span class="co">#&gt; smokerYes:total_bill -0.06757    0.01419   -4.76  3.3e-06 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.979 on 240 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.506,  Adjusted R-squared:   0.5 </span>
<span class="co">#&gt; F-statistic: 81.9 on 3 and 240 DF,  p-value: &lt;2e-16</span></code></pre></div>
<p>Der Schätzwert für die Interaktion steht bei <code>:</code>. Hier also: Wenn geraucht wurde, ist die Steigung im Durchschnitt um 6,8 Cent geringer. Aber wenn geraucht wurde, ist die Rechnung im Achsenabschnitt erstmal um 1,20$ höher (Effekt, ceteris paribus). Wer will, kann ausrechnen, ab welcher Rechnungshöhe Rauchertische im Mittelwert lukrativer sind…</p>
<p>Das gleiche Bild (höhere Achsenabschnitt, geringere Steigung) ergibt sich übrigens bei getrennten Regressionen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lm</span>(tip~total_bill, <span class="dt">data=</span>tips, <span class="dt">subset =</span> smoker==<span class="st">&quot;Yes&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = tip ~ total_bill, data = tips, subset = smoker == </span>
<span class="co">#&gt;     &quot;Yes&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)   total_bill  </span>
<span class="co">#&gt;      1.5643       0.0696</span>
<span class="kw">lm</span>(tip~total_bill, <span class="dt">data=</span>tips, <span class="dt">subset =</span> smoker==<span class="st">&quot;No&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = tip ~ total_bill, data = tips, subset = smoker == </span>
<span class="co">#&gt;     &quot;No&quot;)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)   total_bill  </span>
<span class="co">#&gt;       0.360        0.137</span></code></pre></div>
</div>
<div id="weitere-modellierungsmoglichkeiten" class="section level3">
<h3><span class="header-section-number">11.7.3</span> Weitere Modellierungsmöglichkeiten</h3>
<p>Über das Formelinterface <code>y~x</code> können auch direkt z. B. Polynome modelliert werden. Hier eine quadratische Funktion:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">lm</span>(tip~<span class="kw">I</span>(total_bill^<span class="dv">2</span>)+total_bill, <span class="dt">data=</span>tips))
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = tip ~ I(total_bill^2) + total_bill, data = tips)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt; -3.200 -0.559 -0.098  0.484  3.776 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)      8.91e-01   3.47e-01    2.57  0.01078 *  </span>
<span class="co">#&gt; I(total_bill^2) -5.71e-05   6.02e-04   -0.09  0.92457    </span>
<span class="co">#&gt; total_bill       1.08e-01   3.08e-02    3.51  0.00054 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.02 on 241 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.457,  Adjusted R-squared:  0.452 </span>
<span class="co">#&gt; F-statistic:  101 on 2 and 241 DF,  p-value: &lt;2e-16</span></code></pre></div>
<p>D. h., die geschätzte Funktion ist eine “umgedrehte Parabel” (negatives Vorzeichen bei <code>I(total_bill^2)</code>), bzw. die Funktion ist konkav, die Steigung nimmt ab. Allerdings ist der Effekt nicht signifikant. <strong>Hinweis:</strong> Um zu “rechnen” und nicht beispielsweise Interaktion zu modellieren, geben Sie die Variablen in der Formel in der Funktion <code>I()</code> (<em>As Is</em>) ein.</p>
</div>
<div id="prognoseintervalle" class="section level3">
<h3><span class="header-section-number">11.7.4</span> Prognoseintervalle</h3>
<p>Insgesamt haben wir viel “Unsicherheit” u. a. aufgrund von Variabilität in den Beobachtungen und in den Schätzungen. Wie wirken sich diese auf die Prognose aus?</p>
<p>Dazu können wir über die Funktion <code>predict.lm</code> Prognoseintervalle berechnen – hier für das einfache Modell <code>LinMod.1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newdat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">total_bill =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">75</span>))
preddat &lt;-<span class="st"> </span><span class="kw">predict</span>(LinMod<span class="fl">.1</span>, <span class="dt">newdata =</span> newdat, <span class="dt">interval =</span> <span class="st">&quot;prediction&quot;</span>)
<span class="kw">head</span>(preddat)
<span class="co">#&gt;    fit    lwr  upr</span>
<span class="co">#&gt; 1 0.92 -1.117 2.96</span>
<span class="co">#&gt; 2 1.03 -1.010 3.06</span>
<span class="co">#&gt; 3 1.13 -0.903 3.16</span>
<span class="co">#&gt; 4 1.24 -0.797 3.27</span>
<span class="co">#&gt; 5 1.34 -0.690 3.37</span>
<span class="co">#&gt; 6 1.45 -0.583 3.47</span>
<span class="kw">tail</span>(preddat)
<span class="co">#&gt;     fit  lwr  upr</span>
<span class="co">#&gt; 71 8.27 6.13 10.4</span>
<span class="co">#&gt; 72 8.38 6.23 10.5</span>
<span class="co">#&gt; 73 8.48 6.33 10.6</span>
<span class="co">#&gt; 74 8.59 6.43 10.7</span>
<span class="co">#&gt; 75 8.69 6.53 10.9</span>
<span class="co">#&gt; 76 8.80 6.63 11.0</span>
<span class="kw">matplot</span>(newdat$total_bill, preddat, <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">type=</span><span class="st">&quot;l&quot;</span> )
<span class="kw">points</span>(<span class="dt">x=</span>tips$total_bill, <span class="dt">y=</span>tips$tip)</code></pre></div>
<p><img src="071_Regression_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Sie sehen, dass 95% Prognoseintervall ist recht breit: über den gewählten Rechnungsbereich von <span class="math inline">\(0-75\)</span>$ im Mittelwert bei 4.11$.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>((preddat[,<span class="dv">3</span>]-preddat[,<span class="dv">2</span>]))
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;    4.03    4.04    4.07    4.12    4.17    4.34</span></code></pre></div>
<p>Zu den Rändern hin wird es breiter. Am schmalsten ist es übrigens beim Mittelwert der unabhängigen Beobachtungen, hier also bei 19.79$.</p>
<hr />
</div>
</div>
<div class="footnotes">
<hr />
<ol start="56">
<li id="fn56"><p>siehe z. B. Rob J Hyndman &amp; George Athanasopoulos, Forecasting: principles and practice, Kapitel 5.3: Selecting predictors, <a href="https://www.otexts.org/fpp/5/3" class="uri">https://www.otexts.org/fpp/5/3</a><a href="vertiefungen-zum-regressionmodell.html#fnref56">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modellgute-bei-regressionsmodellen.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ubung-teaching-rating.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
